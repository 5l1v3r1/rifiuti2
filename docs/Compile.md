## Compile Requirements

* `glib` ≥ 2.28 (deveopment headers and libraries)
    * The requirement on MinGW is higher, needing `glib` ≥ 2.40
    * For ancient platforms, please build 0.6.1 source instead, which
      requires `glib` 2.16.
* `pkg-config` or `pkgconf` (on BSD)
* basic development toolchain
    * C compiler &mdash; both `gcc` and `clang` are fine
    * make (non-GNU make also works)

Building from fresh git source needs some extra packages:
* automake ≥ 1.11
* autoconf

A few extra programs are also checked (`iconv`, `xmllint`), but they are
for testsuite only and not necessary for building software.

## Compile Procedure

### Compiling from git source

Autotools files need to be generated by `autogen.sh` before compiling;
this step isn't necessary for those compiling from tarballs.
```
$ ./autogen.sh
```

### Normal compile procedures

*(Note that this including MSYS2, but not MinGW)*

1. Everything follows the usual autotools procedure.
    * `gcc` is the default compiler used:
    ```
    ./configure && make check
    ```
    * `clang` users need to specify `$CC` manually:
    ```
    ./configure CC=clang && make check
    ```

2. *Optional*: install software with admin privilege. By default
   it would be installed under `/usr/local`. Use
   `configure --prefix=<PREFIX>` to override it.
```
make install
```

`rifiuti2` can be used even without installing, only that output messages
would not be translated; functionality would not change at all.

If compile or `make check` fails, please [report problem on Github page][3],
describing your OS and compile environment, and attach relevant testsuite
log file(s).

### Compile procedures on mingw-w64

This section solely covers building for 32bit and 64bit target under
[MSYS2][1], where `rifiuti2` has only been thoroughly tested on.
There are other similar distributions like [win-build][4]
(also based on mingw-w64) or [old MSYS][5] (used to be 32-bit only
but seems to support 64-bit now); your mileage may vary.

1. For 64-bit build target, follow devel packages below are needed,
which can be installed via `pacman`, its package manager.
For 32-bit builds, replace all instances of `x86_64` with `i686`.
    * `mingw-w64-x86_64-gcc` and/or `mingw-w64-x86_64-clang`
    * `automake`
    * `autoconf`
    * `mingw-w64-x86_64-glib2`

2. Follow usual autotools procedure to run `configure` script and make.
   However, `make` is available in MinGW as `mingw32-make`, so
   invocation of `configure` is a bit different:
   ```
   ./configure MAKE=mingw32-make CC=clang
   mingw32-make check
   ```

## Running as standalone Windows executable

There are 2 choices allowing `rifiuti2` to run outside MSYS2 / MinGW
bash:
1. Compile program statically with `./configure --enable-static`. This
   is the chosen route for Windows binary distributed since 0.6.1.
2. Compile program dynamically (without options), and then copy all
    necessary libraries under either `/mingw64/bin` or `/mingw32/bin` to
    the same folder `rifiuti` binaries reside in. This was how it's
    done for distribution of older versions.

*Hint*: For 2<sup>nd</sup> case, use `ldd rifiuti.exe` to discover
external libraries `rifiuti2` is linked against.

**Note 1**:
0.6.1 Windows binary distributed on Github are statically linked to
glib version 2.44, which was available in MSYS2 circa May 2015.

## Compile on macOS
(To be filled)

[1]: https://msys2.github.io/
[2]: http://mingw-w64.yaxm.org/doku.php
[3]: https://github.com/abelcheung/rifiuti2/issues
[4]: https://mingw-w64.org/doku.php/download/win-builds
[5]: http://www.mingw.org/wiki/msys
[6]: https://github.com/msys2/msys2/wiki/MSYS2-installation
[7]: https://github.com/msys2/msys2/wiki/MSYS2-introduction
