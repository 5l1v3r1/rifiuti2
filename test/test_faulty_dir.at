dnl -*- mode: m4; -*-
dnl Test suite for rifiuti2

AT_SETUP([Index files of different versions])
AT_KEYWORDS([recycledir crafted])
AT_CHECK([
	cp $sample/dir-mixed.txt expout
	cd $sample
	$progd dir-mixed
], [3], [expout])
AT_CLEANUP

AT_SETUP([Directory w/o Windows access permission])
AT_KEYWORDS([recycledir crafted windows])
AT_CHECK([which icacls.exe > /dev/null || exit 77])dnl need 2003 SP2 or later
dnl Double slash prevents transformation of command options into drive letters
AT_CHECK([
	cp -pR $sample/dir-win10-01 dir1
	icacls.exe dir1 //inheritance:r > /dev/null
	icacls.exe dir1 //grant:r "Users:(OI)(CI)(S,REA)" > /dev/null
	$progd dir1
],
	[2],, [Error listing directory: Insufficient permission.
No files with name pattern '$Ixxxxxx.*' are found in directory.
],
	[icacls.exe dir1 //reset > /dev/null],
	[icacls.exe dir1 //reset > /dev/null])
AT_CLEANUP

AT_SETUP([Directory w/o Unix access permission])
AT_KEYWORDS([recycledir crafted unix])
AT_SKIP_IF([$is_windows])
AT_CHECK([
	cp -pR $sample/dir-win10-01 dir1
	chmod u= dir1
	$progd dir1
],
	[2],, [Error opening directory 'dir1': Error opening directory 'dir1': Permission denied
No files with name pattern '$Ixxxxxx.*' are found in directory.
])
AT_CLEANUP

dnl vim: set ts=4 sw=4 noexpandtab :
