dnl -*- mode: m4; -*-
dnl Test suite for rifiuti2

AT_SETUP([Err on non-existent input])
AT_KEYWORDS([file])
AT_CHECK([
	rm -rf foobar
	$abs_top_builddir/src/rifiuti foobar
], [2], [], [ignore])
AT_CHECK([
	rm -rf foobar
	$abs_top_builddir/src/rifiuti-vista foobar
], [2], [], [ignore])
AT_CLEANUP

AT_SETUP([Err on non-regular file (Unix)])
AT_KEYWORDS([file])
AT_CHECK([${is_mingw} && exit 77 || exit 0])
AT_CHECK([$abs_top_builddir/src/rifiuti /dev/zero], [2], [], [ignore])
AT_CHECK([$abs_top_builddir/src/rifiuti-vista /dev/zero], [2], [], [ignore])
AT_CLEANUP

dnl g_file_test() was not so usable on Windows: NUL, CON etc are considered as regular files.
dnl Therefore file can't be determined early as unusable, they have to be actually parsed.
AT_SETUP([Err on non-regular file (Windows)])
AT_KEYWORDS([file])
AT_CHECK([${is_mingw} || exit 77])
AT_CHECK([$abs_top_builddir/src/rifiuti nul], [3], [], [ignore])
AT_CHECK([$abs_top_builddir/src/rifiuti-vista nul], [3], [], [ignore])
AT_CLEANUP

AT_SETUP([UTF-8 console/file output are equal])
AT_KEYWORDS([file])
AT_CHECK([
	$abs_top_builddir/src/rifiuti -8 -o expout $srcdir/samples/INFO2-sample1
	$abs_top_builddir/src/rifiuti -8           $srcdir/samples/INFO2-sample1
],, [expout], [])
AT_CHECK([
	$abs_top_builddir/src/rifiuti-vista -8 -o expout $srcdir/samples/dir-sample1
	$abs_top_builddir/src/rifiuti-vista -8           $srcdir/samples/dir-sample1
],, [expout], [])
AT_CLEANUP

AT_SETUP([Read non-ASCII path])
AT_KEYWORDS([file encoding])
AT_CHECK([
	$abs_top_builddir/src/rifiuti       $srcdir/samples/ごみ箱/INFO2-empty
],, [ignore], [ignore])
AT_CHECK([
	$abs_top_builddir/src/rifiuti-vista $srcdir/samples/ごみ箱/dir-empty
],, [ignore], [ignore])
AT_CLEANUP

dnl vim: set ts=4 sw=4 noexpandtab :
