dnl -*- coding: utf-8; mode: m4; -*-
dnl vim: set fileencoding=utf-8 filetype=m4 ts=4 sw=4 noexpandtab :
dnl
dnl Test suite for rifiuti2

dnl
dnl ごみ箱 is 'recycle bin' in Japanese
dnl
AT_SETUP([Unicode characters in file argument])
AT_KEYWORDS([encoding])
AT_CHECK([
	cp $sample/japanese-path-file.txt expout
	cd $sample
	$progf ./ごみ箱/INFO2-empty
],, [expout])

AT_CHECK([
	rm -f expout
	cp $sample/japanese-path-dir.txt expout
	cd $sample
	$progd ./ごみ箱/dir-empty
],, [expout])
AT_CLEANUP

dnl
dnl Original file in Windows ANSI (CP1252), but users attempts
dnl to treat it as Shift-JIS, and fails
dnl TODO: also check stderr
dnl TODO: determine if exit status should be non-zero
dnl
AT_SETUP([Err when converting from wrong charset])
AT_KEYWORDS([encoding])
AX_AT_CHECK_PATTERN([
	cp $sample/INFO2-sample2-wrong-enc.txt expout
	cd $sample
	$progf -l CP932 INFO2-sample2
],, [expout], [
.*: rifiuti2-WARNING .*: Error converting file name from CP932 encoding to UTF-8 for index 3: Invalid byte sequence in conversion input
])
AT_CLEANUP
